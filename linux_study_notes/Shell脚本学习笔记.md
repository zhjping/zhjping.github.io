## shell脚本学习笔记

### 1. shell概述

- __shell是什么__
	
	```
    shell是一个命令行解释器，它为用户提供了一个向Linux内核发送
    请求以便运行程序的界面系统级程序，用户可以用shell来启动，
	挂起，停止，甚至是编写一些程序。shell还是一个功能相当强大的
	编程语言，易编写，易调试，灵活性较强。shell是解释执行的脚本
	语言，在shell中可以直接调用Linux系统命令
	```

- __Bourne Shell与C Shell__  
	```
	从1979年起就开始使用Bourne Shell，Bourne Shell的主文件名为sh。
    C Shell主要在BSD版的Unix系统中使用，其语法和C语言相似而得名。  
	Shell的两种主要语法类型有Bourne和C，这两种语法彼此不兼容。
	Bourne家族（主要是Linux使用）主要包括sh，ksh，Bash，psh，zsh；
	C家族（主要Unix使用）主要包括：csh，tcsh。
	```

- __查看当前Shell类型__
	```
	[root@localhost ~]#echo $SHELL
        $：表示调用变量名

	查看当前系统的可用shell
        cat /etc/shells

	切换shell：输入要切换的shell名称后按回车
        [root@localhost ~]#sh
        返回输入exit
	```

### 2. 脚本执行方式

- __echo输出命令__
    ```
    echo [选项] [输出内容]
    选项：
        -e    支持反斜线控制的字符转换
    [root@localhost ~]#echo -e "\e [1; 31m hello world \e[0m"
    输出颜色：
        30m=黑色    31m=红色    32m=绿色    33m=黄色
        34m=蓝色    35m=洋红    36m=青色    37m=白色
    ```

- __一个示例脚本__  
    `[root@localhost ~]# vim hello.sh`

    ```
    #!/bin/bash
    #The first program

    echo -e "\e[1;34m Hello world \e[0m"
    ```

- __脚本执行__  
    - 赋予执行权限，直接运行  
        `[root@localhost ~]#chmod 755 hello.sh`  
        `[root@localhost ~]#./hello.sh`

    - 通过Bash调用执行脚本  
        `bash hello.sh`

### 3. Bash的基本功能  

#### 3.1 命令别名与快捷键  
- __查看与设定别名__
    ```
    alias   #查看系统中所以的命令别名
    alias   别名='原命令'   #设定命令别名
    ```

- __别名永久生效与删除别名__
    ```
	vi /root/.bashrc    #写入环境变量配置文件（重起后生效）
	执行： source .bashrc 后直接永久生效
	unalias 别名        #删除别名（暂时删除）

	注意：用命令行修改别名暂时生效，用文件修改别名永久生效
    ```

- __命令生效顺序__
    ```
    1. 第一顺位执行用绝对路径或相对路径执行的命令
    2. 第二顺位执行别名
    3. 第三顺位执行Bash的内部命令
    4. 第四顺位执行按照$PATH环境变量定义的目录查找顺序找到的第一个命令
    ```

- __常用快捷键__
    ```
    ctrl+c	强制终止当前命令
    ctrl+l	清屏
    ctrl+a	光标移动到命令行行首
    ctrl+e	光标移动到命令行行尾
    ctrl+u	从光标所在位置删除到行首
    ctrl+z	把命令放入后台
    ctrl+r	在历史命令中搜索
    ```

#### 3.2 输入输出重定向
- __输出重定向__
    ```
    标准输出重定向：
        命令 > 文件     以覆盖的方式，把命令的正确输出输出到指定的文件或设备中
        命令 >> 文件    以追加的方式，把命令的正确输出输出到指定的文件或设备中

    标准错误输出重定向：
        错误命令 2> 文件    以覆盖的方式，把命令的错误输出输出到指定的文件或设备中
        错误命令 2>> 文件   以追加的方式，把命令的错误输出输出到指定的文件或设备中

    正确输出和错误输出同时保存：
        命令 > 文件 2>&1    以覆盖的方式，把命令的正确和错误输出都保存到同一个文件当中
        命令 >> 文件 2>&1   以追加的方式，把命令的正确和错误输出都保存到同一个文件当中

        命令 &> 文件    以覆盖的方式，把命令的正确和错误输出都保存到同一个文件当中
        命令 &>> 文件   以追加的方式，把命令的正确和错误输出都保存到同一个文件当中

        命令 >> 文件1 2>> 文件2     把正确输出追加到文件1中，把错误输出追加到文件2中
    ```

- __输入重定向__
    ```
    [root@localhost ~]#wc [选项名] [文件名]  
    选项：  
        -c	统计字节数  
        -w	统计单词数  
        -l	统计行数  

    命令 < 文件     把文件作为命令的输入  
    命令 << 标识符  把标识符和标识符之间的内容作为命令的输入  
    ```
#### 3.3 管道符
- __;__  
	```
    command1;command2  
	多个命令顺序执行，命令之间没有任何逻辑联系  
    ```

- __&&__  
	```
    command1&&command2  
	逻辑与，当command1正确执行，则command2才会执行；
    当command1不正确执行，则command2不会执行
    ```

- __||__  
	```
    command1||command2  
	逻辑或，当command1执行不正确，则command2才会执行；
    当command1正确执行，则command2不会执行
    ```

- __管道符命令格式__  
	```
    [root@localhost ~]#command1 | command2 
	"command1"的正确输出作为"command2"的操作对象
    ```

- __举例__  
	`netstat -an | grep ESTABLISHED | wc -l`  
	`ll -a /etc/ | more`


#### 3.4 通配符
- __？__  
	```
    匹配1个任意字符。
    ```

- __*__  
	```
    匹配0个或多个任意字符，也就是可以匹配任意内容。
    ```

- __[]__  
	```
    匹配中括号中的任意1个字符。
    ```

- __[-]__  
	```
    匹配中括号中的任意1个字符,-代表一个范围。例如：[a-z]代表匹配1个小写字母。
    ```

- __[^]__  
	```
    逻辑非，表示匹配不是中括号内的一个字符。例如：[^0-9]代表匹配一个不是数字的字符。
    ```

- __''__  
	```
    单引号，在单引号中的所有特殊符号，如"$","`"（反引号）都没有特殊含义。
    ```

- __""__  
	```
    双引号，在双引号中的特殊符号都没有特殊含义，但是"$","`"(反引号)和"\\"是例外，
    拥有"调用变量的值","引用命令"和"转义符"的特殊含义
    ```

- __``__  
	```
    反引号，反引号括起来的是系统命令，在Bash中会先执行它。和\$()作用一样，
    不过推荐使$(),因为反引号非常容易看错。\$()	和反引号作用一样，用来引用
    系统命令
    ```

- __#__  
	```
    在shell脚本中，#开头的行代表注释，(第一行的#!开头是个例外)；注释也可以放在
    语句的后面，#前面的命令会被正常执行；#前面可以有空白符；echo中转义的#不能
    作为注释
    ```

- __\$__  
	```
    用于调用变量的值，如：需要调用变量name的值时，需要用$name的方式得到变量的值
    ```

- __\\__  
	```
    转义符，跟在\之后的特殊符号将失去特殊含义，变为普通字符。如：\$将输出"$"符号，
    而不是当作变量引用。
    ```
#### 3.5 内置变量
- __UID__  
    ```
    为当前用户的ID号
    ```

- __"$*"型内置变量__
    ```
    "$#"    传给shell程序的位置参数个数
    "$0"    脚本名称.
    "$n"    (n>0)获取传递的第n个参数,如第一个参数$1.
    "$?"    上个命令的退出状态,或函数的返回值.
    "$!"    运行在后台的最后一个作业的PID(进程ID).
    "$$"    当前Shell进程ID.对于Shell脚本,就是这些脚本所在的进程ID.
    "$*"    传递给脚本或函数的所有参数.
    "$@"    传递给脚本或函数的所有参数,被双引号""包含时,与$*稍有不同.
    ```

#### 3.6 语法
- __if条件语句__  
    ```
    if condition
    then
        take-some-action
    else
        take-some-action
    fi
    ```
    ```
    if condition; then
        take-some-action
    else
        take-some-action
    fi
    ```

- __for循环__  
    ```
    for((i=1;i<=10;i++))
    do
        echo $(expr $i \* 3 + 1)
    done
    ```
    ```
    for i in $(seq 1 10)
    do
        echo $(expr $i \* 3 + 1)
    done
    ```

- __while循环__  
    ```
    while condition
    do
        operation-1
        operation-2
        ...
        operation-n
    done
    ```

- __;;__  
    ```
    用于终止case选项(双分号,即;;)，如：
    case "$variable" in
        "1")
            echo "1";;
        "2")
            echo "2";;
        "3")
            echo "3";;
    esac
    ```

- __.__  
    ```
    1. “点”命令(句点,即.)，等价于source命令，这是一个bash的内建命令。
    2. “点”作为文件名的一部分放在开头时，这个文件为隐藏文件,ls命令需要加“-a”
        选项才能显示；当作为目录时表示当前目录，而两个点表示上一级目录。
    3. "点"字符匹配。 当用作匹配字符的作用时，通常都是作为正则表达式的一部分来
        使用， "点"用来匹配任何的单个字符。
    ```

- __,__  
    ```
    逗号操作符链接了一系列的操作，里面所有的内容都会被运行，但只有最后一项被
    返回。
    ```

- __/__  
    ```
    文件名路径分隔符[斜线，即/]。 分隔文件名不同的部分，也可以用来作为除法
    算术操作符。
    ```

- __`__
    ```
    命令替换，`command`结构可以将命令的输出赋值到一个变量中去。
    ```

- __:__
    ```
    
    (1)空命令,等价于"NOP"(no op,一个什么也不干的命令).也可以被认
    为与shell的内建命令true作用相同.":"命令是一个bash的内建命令,它
    的退出码是"true".
    (2)在if/then中的占位符
    if condition
        then : # 什么都不做,引出分支.
    else
        take-some-action
    fi
    (3)在一个二元命令中提供一个占位符.??不懂...
    (4)":"还用来在/etc/passwd和$PATH变量中做分隔符.
    ```

- __!__
    ```
    取反操作符[叹号，即!]。!操作符将会反转命令的退出码的结果，!操作符是Bash的
    关键字。
    ```

- __*__
    ```
    1. 通配符[星号，即*]。*可以用来做文件名匹配的“通配符”。含义是可以用来匹配
        给定目录下的任何文件名。
    2. 算术操作符。在算术操作符的上下文中，*号表示乘法运算。如果要做求幂运算，
        使用**，这是求幂操作符。如let "z=5**3"
    ```

- __?__
    ```
    1. 测试操作符。在一个特定的表达式中，?用来测试一个条件的结果。
    2. 在一个双括号结构中，?就是C语言的三元操作符，如
        ((t = a < 45 ? 7 : 11))
    3. 在参数替换表达式中，?用来测试一个变量是否被set了。
    4. 通配符。?在通配中，用来做匹配单个字符的“通配符”，在正则表达式中，也是
        用来表示一个字符。
    ```

- __$__  
    ```
    (1)变量替换(引用变量的内容).
    var1=5
    echo $var1
    (2)行结束符.在正则表达式中,"$"表示行结束符.
    ```

- __${}__
    ```
    参数替换。
    ```

- __()__
    ```
    (1)命令组.
    (a=hello; echo $a)
    在括号中的命令列表,将会作为一个子shell来运行.
    在括号中的变量,由于是在子shell中,所以对于脚本剩下的部分是不可用
    的.父进程,也就是脚本本身,将不能够读取在子进程中创建的变量,也就
    是在子shell中创建的变量.
    (2)初始化数组,用空格分隔.
    Array=(element1 element2 element3)
    ```

- __{}__
    ```
    (1)大括号扩展.在大括号中,不允许有空白,除非这个空白被引用或转义.
    echo {file1,file2}\ :{\ A," B",' C'}
    file1 : A file1 : B file1 : C file2 : A file2 : B file2 : C
    (2)代码块[大括号,即{}].
    又被称为内部组, 这个结构事实上创建了一个匿名函数(一个没有名字的
    函数).然而,与"标准"函数不同的是,在其中声明的变量,对于脚本其他
    部分的代码来说还是可见的.
    ```

- __{} \;__
    ```
    路径名.
    一般都在find命令中使用.这不是一个shell内建命令.
    ";"用来结束find命令序列的-exec选项.它需要被保护以防止被shell所
    解释.
    ```

- __[ ]__
    ```
    (1)条件测试.
    条件测试表达式放在[ ]中。值得注意的是，"["是shell内建test命令的一部
    分,并不是/usr/bin/test中的外部命令的一个链接。
    (2)数组元素。
    在一个array结构的上下文中,中括号用来引用数组中每个元素的编号。
    Array[1]=slot_1
    echo ${Array[1]}
    (3)字符范围。
    用作正则表达式的一部分,方括号描述一个匹配的字符范围
    ```

- __[[ ]]__
    ```
    测试.
    测试表达式放在[[ ]]中.使用[[ ... ]]条件判断结构, 而不是[ ... ],
    能够防止脚本中的许多逻辑错误.比如,&&,||,<,和>操作符能够正常存在
    于[[ ]]条件判断结构中,但是如果出现在[ ]结构中的话,会报错
    ```

- __(( ))__
    ```
    整数扩展，扩展并计算在(( ))中的整数表达式。
    ```

- __\<text\>__
    ```
    正则表达式中的单词边界。
    bash$ grep '\<the\>' textfile
    ```

- __&__
    ```
    后台运行命令。一个命令后边跟一个&表示在后台运行。
    ```

- __=__
    ```
    1. 赋值操作，前后都不能有空白。
        a=28
        echo $a # 28
    2. 字符串比较
        if [ "$a" = "$b" ]
    ```

- __+__
    ```
    1. 加号，加法算术操作。在另一种上下文环境中，+也是一种正则
        表达式操作。
    2. 选项，一个命令或者过滤器的选项标记。某些命令内建命令使用
        +来打开特定的选项，用-来禁用这些特定的选项。
    ```

- __-__
    ```
    1. 选项前缀。在所有的命令内如果想使用选项参数的话，前边都要
        加上"-"。
    2. 先前的工作目录。"cd -"将会回到先前的工作目录。它使用了
        $OLDPWD环境变量.
    3. 减号。减号属于算术操作。
    ```

- __%__
    ```
    取模。取模(一次除法的余数)算术操作。在不同的上下文中，%也是
    一种模式匹配操作。
    ```

- __~__
    ```
    home目录[波浪号，即~]。相当于$HOME内部变量。
    ```

- __~+__
    ```
    当前工作目录。相当于$PWD内部变量。
    ```

- __~-__
    ```
    先前的工作目录。相当于$OLDPWD内部变量。
    ```

- __=~__
    ```
    正则表达式匹配。这个操作将会在version 3版本的Bash部分进行讲解。
    ```

- __^__
    ```
    行首。在正则表达式中，"^"表示定位到文本行的行首。
    ```

### 4. 常用shell脚本命令使用说明

- __tr命令__  
```
    tr（translate缩写）主要用于删除文件中的控制字符，或进行字符转换。  
    语法：tr [–c/d/s/t] [SET1] [SET2]  
        SET1: 字符集1  
        SET2：字符集2  
        -c:complement，保留SET1中的字符，将其他字符替换为SET2  
        -d:delete，删除SET1中所有的字符，不转换  
        -s: squeeze-repeats，压缩SET1中重复的字符  
        -t: truncate-set1，将SET1中的字符转换成SET2，一般缺省为-t  
```

- __seq命令__


- __awk命令__

